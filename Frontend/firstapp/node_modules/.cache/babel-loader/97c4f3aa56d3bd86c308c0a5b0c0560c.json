{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Pallavi\\\\Desktop\\\\React\\\\firstapp\\\\src\\\\components\\\\userboard\\\\CheckoutForm.js\";\nimport React, { useState } from 'react';\nimport { useStripe, useElements, CardElement } from '@stripe/react-stripe-js';\nimport axios from 'axios';\nconst CARD_ELEMENT_OPTIONS = {\n  style: {\n    base: {\n      fontSize: '16px',\n      color: '#32325d',\n      '::placeholder': {\n        color: '#a0aec0'\n      }\n    },\n    invalid: {\n      color: '#e53e3e'\n    }\n  }\n};\nconst CheckoutForm = ({\n  clientSecret,\n  orderId,\n  artworkId\n}) => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const token = localStorage.getItem('token');\n  const [paymentStatus, setPaymentStatus] = useState('');\n  const [error, setError] = useState('');\n  const [downloadUrl, setDownloadUrl] = useState('');\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!stripe || !elements || !clientSecret) return;\n    try {\n      const result = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: elements.getElement(CardElement)\n        }\n      });\n      if (result.error) {\n        console.error(result.error.message);\n        setError(result.error.message);\n        return;\n      }\n      const status = result.paymentIntent.status;\n      const mappedStatus = status === 'succeeded' ? 'COMPLETED' : 'FAILED';\n      await axios.post('http://localhost:8080/api/payments/confirm', {\n        transactionId: result.paymentIntent.id,\n        status: mappedStatus\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (mappedStatus === 'COMPLETED') {\n        setPaymentStatus('Payment successful!');\n        fetchDownloadUrl();\n      } else {\n        setPaymentStatus('Payment failed. Try again.');\n      }\n    } catch (err) {\n      console.error('Error confirming payment:', err);\n      setError('Failed to confirm payment.');\n    }\n  };\n  const fetchDownloadUrl = async () => {\n    try {\n      const res = await axios.get(`http://localhost:8080/api/artworks/download/${artworkId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (res.data.downloadUrl) {\n        setDownloadUrl(res.data.downloadUrl);\n      } else {\n        setError('Download URL not found.');\n      }\n    } catch (err) {\n      console.error('Error fetching download URL:', err);\n      setError('Unable to fetch download link.');\n    }\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"p-4 border border-gray-300 rounded-md mb-4 bg-white\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(CardElement, {\n    options: CARD_ELEMENT_OPTIONS,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    disabled: !stripe || !elements,\n    className: \"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }\n  }, \"Pay Now\")), error && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"mt-4 text-center text-red-500 font-semibold\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }\n  }, error), /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: \"gold\",\n      fontWeight: \"bold\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }\n  }, paymentStatus), paymentStatus === 'Payment successful!' && downloadUrl && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"text-center mt-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    href: downloadUrl,\n    className: \"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-block\",\n    download: true,\n    target: \"_blank\",\n    rel: \"noopener noreferrer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 5\n    }\n  }, \"Download Artwork\")));\n};\nexport default CheckoutForm;","map":{"version":3,"names":["React","useState","useStripe","useElements","CardElement","axios","CARD_ELEMENT_OPTIONS","style","base","fontSize","color","invalid","CheckoutForm","clientSecret","orderId","artworkId","stripe","elements","token","localStorage","getItem","paymentStatus","setPaymentStatus","error","setError","downloadUrl","setDownloadUrl","handleSubmit","e","preventDefault","result","confirmCardPayment","payment_method","card","getElement","console","message","status","paymentIntent","mappedStatus","post","transactionId","id","headers","Authorization","fetchDownloadUrl","err","res","get","data","createElement","Fragment","onSubmit","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","className","options","type","disabled","fontWeight","href","download","target","rel"],"sources":["C:/Users/Pallavi/Desktop/React/firstapp/src/components/userboard/CheckoutForm.js"],"sourcesContent":["\r\nimport React, { useState } from 'react';\r\nimport { useStripe, useElements, CardElement } from '@stripe/react-stripe-js';\r\nimport axios from 'axios';\r\n\r\nconst CARD_ELEMENT_OPTIONS = {\r\n  style: {\r\n    base: {\r\n      fontSize: '16px',\r\n      color: '#32325d',\r\n      '::placeholder': {\r\n        color: '#a0aec0',\r\n      },\r\n    },\r\n    invalid: {\r\n      color: '#e53e3e',\r\n    },\r\n  },\r\n};\r\n\r\nconst CheckoutForm = ({ clientSecret, orderId, artworkId }) => {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const token = localStorage.getItem('token');\r\n\r\n  const [paymentStatus, setPaymentStatus] = useState('');\r\n  const [error, setError] = useState('');\r\n  const [downloadUrl, setDownloadUrl] = useState('');\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!stripe || !elements || !clientSecret) return;\r\n\r\n    try {\r\n      const result = await stripe.confirmCardPayment(clientSecret, {\r\n        payment_method: {\r\n          card: elements.getElement(CardElement),\r\n        },\r\n      });\r\n\r\n      if (result.error) {\r\n        console.error(result.error.message);\r\n        setError(result.error.message);\r\n        return;\r\n      }\r\n\r\n      const status = result.paymentIntent.status;\r\n      const mappedStatus = status === 'succeeded' ? 'COMPLETED' : 'FAILED';\r\n\r\n      await axios.post(\r\n        'http://localhost:8080/api/payments/confirm',\r\n        {\r\n          transactionId: result.paymentIntent.id,\r\n          status: mappedStatus,\r\n        },\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      if (mappedStatus === 'COMPLETED') {\r\n        setPaymentStatus('Payment successful!');\r\n        fetchDownloadUrl();\r\n      } else {\r\n        setPaymentStatus('Payment failed. Try again.');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error confirming payment:', err);\r\n      setError('Failed to confirm payment.');\r\n    }\r\n  };\r\n\r\n  const fetchDownloadUrl = async () => {\r\n    try {\r\n      const res = await axios.get(\r\n        `http://localhost:8080/api/artworks/download/${artworkId}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n\r\n      if (res.data.downloadUrl) {\r\n        setDownloadUrl(res.data.downloadUrl);\r\n      } else {\r\n        setError('Download URL not found.');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error fetching download URL:', err);\r\n      setError('Unable to fetch download link.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <form onSubmit={handleSubmit}>\r\n        <div className=\"p-4 border border-gray-300 rounded-md mb-4 bg-white\">\r\n          <CardElement options={CARD_ELEMENT_OPTIONS} />\r\n        </div>\r\n\r\n        <button\r\n          type=\"submit\"\r\n          disabled={!stripe || !elements}\r\n          className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\"\r\n        >\r\n          Pay Now\r\n        </button>\r\n      </form>\r\n\r\n      {error && (\r\n        <p className=\"mt-4 text-center text-red-500 font-semibold\">{error}</p>\r\n      )}\r\n\r\n      <p style={{ color: \"gold\", fontWeight: \"bold\" }}>\r\n        {paymentStatus}\r\n        </p>\r\n\r\n{paymentStatus === 'Payment successful!' && downloadUrl && (\r\n  <div className=\"text-center mt-6\">\r\n    <a\r\n      href={downloadUrl}\r\n      className=\"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded inline-block\"\r\n      download\r\n      target=\"_blank\"\r\n      rel=\"noopener noreferrer\"\r\n    >\r\n      Download Artwork\r\n    </a>\r\n  </div>\r\n)}\r\n\r\n\r\n\r\n\r\n    </>\r\n  );\r\n};\r\n\r\nexport default CheckoutForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}